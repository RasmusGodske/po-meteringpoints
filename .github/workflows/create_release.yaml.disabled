# --------------- Notes -------------------
# --- Personal Access Token (PAT)
# In order to trigger create a personal token has to be provided instead of GITHUB_TOKEN
# Personal Access token requires following permissions:
# - Access public repositories: repo.public_repo
#
# Remove more at: https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token


on:
  push:
    branches:
      - main

name: Create Release

env:
  REPO_NAME: ${{ github.event.repository.name }}
  REPO_OWNER: ${{ github.repository_owner }}

  # Url of the current job
  JOB_URL: "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
  
  # The event which the update_base_env workflow listens to
  UPDATE_BASE_ENV_TRIGGER_EVENT: "update_base_env" 

jobs:
  CreateRelease:
    name: Create Release
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
 
      - name: Define version
        id: define_version
        run: |
          export MAJOR=0
          export MINOR=0
          export PATCH=${{ github.run_number }}
          export VERSION_NUMBER="V${MAJOR}.${MINOR}.${PATCH}"
          echo $VERSION_NUMBER
          echo "::set-output name=VERSION_NUMBER::$VERSION_NUMBER"

      - uses: "marvinpinto/action-automatic-releases@919008cf3f741b179569b7a6fb4d8860689ab7f0"
        with:
          repo_token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
          automatic_release_tag: ${{steps.define_version.outputs.VERSION_NUMBER}}
          prerelease: false
          draft: false
          title: Release ${{steps.define_version.outputs.VERSION_NUMBER}}
  
  